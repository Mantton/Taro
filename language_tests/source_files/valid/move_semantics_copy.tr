// Test: Move Semantics - Copyable Types
// Checks that Copyable types can be used after being assigned to another variable.

struct Point: Copyable {
    x: int32
    y: int32
}

struct Line: Copyable {
    start: Point
    end: Point
}

func main() {
    test_primitive_copy()
    test_struct_copy()
    test_nested_copy()
    test_tuple_copy()
    std.print("PASS: Copyable types work correctly\n")
}

func test_primitive_copy() {
    let x = 42
    let y = x  // copy, x is still valid
    let z = x  // copy again
    assert(x == 42, "Primitive copy - original")
    assert(y == 42, "Primitive copy - first copy")
    assert(z == 42, "Primitive copy - second copy")
}

func test_struct_copy() {
    let p1 = Point { x: 10, y: 20 }
    let p2 = p1  // copy, p1 is still valid
    let p3 = p1  // copy again

    assert(p1.x == 10, "Struct copy - original.x")
    assert(p1.y == 20, "Struct copy - original.y")
    assert(p2.x == 10, "Struct copy - first copy.x")
    assert(p3.y == 20, "Struct copy - second copy.y")
}

func test_nested_copy() {
    let line = Line {
        start: Point { x: 0, y: 0 },
        end: Point { x: 100, y: 100 },
    }

    let line2 = line  // copy
    let line3 = line  // copy again

    assert(line.start.x == 0, "Nested copy - original")
    assert(line2.end.x == 100, "Nested copy - first copy")
    assert(line3.end.y == 100, "Nested copy - second copy")
}

func test_tuple_copy() {
    let t = (1, 2, 3)
    let t2 = t  // copy
    let t3 = t  // copy again

    assert(t.0 == 1, "Tuple copy - original")
    assert(t2.1 == 2, "Tuple copy - first copy")
    assert(t3.2 == 3, "Tuple copy - second copy")
}
