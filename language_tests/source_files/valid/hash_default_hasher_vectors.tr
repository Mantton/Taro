// TEST

import std.hash.DefaultHasher

const KEY0: uint64 = 0x0706050403020100
const KEY1: uint64 = 0x0f0e0d0c0b0a0908

@test
func sipHash13KnownVectorLen8() {
    let bytes: [uint8; 8] = [0, 1, 2, 3, 4, 5, 6, 7]
    var hasher = DefaultHasher.new(KEY0, KEY1)
    hasher.write(bytes.as_span())
    std.testing.assertEqual(
        hasher.finish(),
        0x369095118d299a8e,
        "SipHash1-3 vector mismatch for len=8",
    )
}

@test
func sipHash13ChunkedWriteMatchesSingleWrite() {
    let bytes: [uint8; 16] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
    let all = bytes.as_span()

    var single = DefaultHasher.new(KEY0, KEY1)
    let full = all.slice(0, 16)
    single.write(full)

    var chunked = DefaultHasher.new(KEY0, KEY1)
    let c0 = all.slice(0, 5)
    let c1 = all.slice(5, 11)
    chunked.write(c0)
    chunked.write(c1)

    std.testing.assertEqual(
        chunked.finish(),
        single.finish(),
        "Chunked writes must match one-shot write",
    )
}
