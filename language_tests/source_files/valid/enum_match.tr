enum Entity {
    case unit
    case tuple(int32, int32)
    case triple(int32, rune)
}

func checkBasicEnumMatch() {
    let a = Entity.unit
    let b = Entity.tuple(10, 20)

    match a {
        case Entity.unit => {
            std.print("PASS: Match unit\n")
        }
        case Entity.tuple(x, y) => {
            let _ = x
            let _ = y
            assert(false, "Should not match tuple")
        }
        case Entity.triple(_, _) => {
            assert(false, "Should not match triple")
        }
    }

    match b {
        case Entity.unit => {
            assert(false, "Should not match unit")
        }
        case Entity.tuple(x, y) => {
            assert(x == 10, "first element mismatch")
            assert(y == 20, "second element mismatch")
            std.print("PASS: Match tuple\n")
        }
        case Entity.triple(_, _) => {
            assert(false, "Should not match triple")
        }
    }
}

func checkMatchExpressionResult() {
    let value = Entity.triple(6, 'A')
    let code = match value {
        case Entity.tuple(a, _) | Entity.triple(a, _) => {
            std.print("Inside match arm\n")
            a * 2
        }
        case _ => {
            10
        }
    }
    assert(code == 12, "match expression return value incorrect")
    std.print("PASS: Match expression returned correct value\n")
}

func checkOrPatterns() {
    let value = Entity.triple(6, 'A')
    match value {
        case Entity.tuple(a, _) | Entity.triple(a, _) => {
            assert(a == 6, "or-pattern extraction failed")
            std.print("PASS: Or-pattern matched\n")
        }
        case _ => {
            assert(false, "failed to match wildcard/default")
        }
    }

    let value2 = Entity.tuple(10, 20)
    match value2 {
        case Entity.tuple(x, _) | Entity.triple(x, _) => {
            assert(x == 10, "or-pattern check second variant")
            std.print("PASS: Or-pattern matched second variant\n")
        }
        case _ => {
            assert(false, "failed to match second variant")
        }
    }
}

func main() {
    checkBasicEnumMatch()
    checkMatchExpressionResult()
    checkOrPatterns()
}
