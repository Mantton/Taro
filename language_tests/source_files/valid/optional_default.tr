// Test: Optional Defaults (??)
// Tests the nil-coalescing operator that provides defaults for Optional types.

import std.prelude.Optional

func main() {
    // Test 1: Basic ?? on .some - should return the value
    let a: int32? = Optional.some(10)
    let result1 = a ?? 0
    assert(result1 == 10, "Basic ?? on .some failed")

    // Test 2: Basic ?? on .none - should return the default
    let b: int32? = Optional.none
    let result2 = b ?? 42
    assert(result2 == 42, "Basic ?? on .none failed")

    // Test 3: Short circuit - first value is some
    let c: int32? = Optional.some(5)
    let result3 = c ?? 999
    assert(result3 == 5, "Short circuit failed")

    // Test 4: Chained ?? - all none, return final default
    // With right-associativity: d ?? (e ?? 77)
    let d: int32? = Optional.none
    let e: int32? = Optional.none
    let result4 = d ?? e ?? 77
    assert(result4 == 77, "Chained ?? all none failed")

    // Test 5: Chained ?? - first is none, second is some
    let f: int32? = Optional.none
    let g: int32? = Optional.some(100)
    let result5 = f ?? g ?? 999
    assert(result5 == 100, "Chained ?? with middle some failed")

    // Test 6: Chained ?? - first is some
    let h: int32? = Optional.some(1)
    let i: int32? = Optional.some(2)
    let result6 = h ?? i ?? 3
    assert(result6 == 1, "Chained ?? first some failed")

    // Test 7: Three-level chain all none
    let j: int32? = Optional.none
    let k: int32? = Optional.none
    let l: int32? = Optional.none
    let result7 = j ?? k ?? l ?? 42
    assert(result7 == 42, "Three-level chain all none failed")

    // Test 8: Deep chaining (6 levels)
    let n1: int32? = Optional.none
    let n2: int32? = Optional.none
    let n3: int32? = Optional.none
    let n4: int32? = Optional.none
    let n5: int32? = Optional.none
    let n6: int32? = Optional.none
    let result8 = n1 ?? n2 ?? n3 ?? n4 ?? n5 ?? n6 ?? 123
    assert(result8 == 123, "Deep chaining (6 levels) all none failed")

    let v6: int32? = Optional.some(88)
    let result9 = n1 ?? n2 ?? n3 ?? n4 ?? n5 ?? v6 ?? 999
    assert(result9 == 88, "Deep chaining (6 levels) with value at end failed")

    // Test 10: String optional with none
    let s: string? = Optional.none
    let result10 = s ?? "default"
    assert(result10 == "default", "String ?? failed")

    // Test 11: String optional with value
    let t: string? = Optional.some("hello")
    let result11 = t ?? "default"
    assert(result11 == "hello", "String ?? with value failed")


    std.print("PASS: Optional defaults (??) working\n")
}
