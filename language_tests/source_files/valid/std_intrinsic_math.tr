import std.intrinsic.{
    __intrinsic_sqrt_f64,
    __intrinsic_sin_f64,
    __intrinsic_cos_f64,
    __intrinsic_tan_f64,
    __intrinsic_exp_f64,
    __intrinsic_exp2_f64,
    __intrinsic_log_f64,
    __intrinsic_log2_f64,
    __intrinsic_log10_f64,
    __intrinsic_fabs_f64,
    __intrinsic_floor_f64,
    __intrinsic_ceil_f64,
    __intrinsic_trunc_f64,
    __intrinsic_round_f64,
    __intrinsic_roundeven_f64,
    __intrinsic_pow_f64,
    __intrinsic_powi_f64_i32,
    __intrinsic_copysign_f64,
    __intrinsic_fma_f64,
    __intrinsic_minimum_f64,
    __intrinsic_maximum_f64,
    __intrinsic_minimumnum_f64,
    __intrinsic_maximumnum_f64,
}

func approxEq(_ a: double, _ b: double, _ eps: double) -> bool {
    let d = unsafe { __intrinsic_fabs_f64(a - b) }
    d <= eps
}

func main() {
    let eps: double = 0.000001

    assert(approxEq(unsafe { __intrinsic_sqrt_f64(9.0) }, 3.0, eps), "sqrt")
    assert(approxEq(unsafe { __intrinsic_sin_f64(0.0) }, 0.0, eps), "sin")
    assert(approxEq(unsafe { __intrinsic_cos_f64(0.0) }, 1.0, eps), "cos")
    assert(approxEq(unsafe { __intrinsic_tan_f64(0.0) }, 0.0, eps), "tan")

    assert(approxEq(unsafe { __intrinsic_exp_f64(0.0) }, 1.0, eps), "exp")
    assert(approxEq(unsafe { __intrinsic_exp2_f64(3.0) }, 8.0, eps), "exp2")
    assert(approxEq(unsafe { __intrinsic_log_f64(1.0) }, 0.0, eps), "log")
    assert(approxEq(unsafe { __intrinsic_log2_f64(8.0) }, 3.0, eps), "log2")
    assert(approxEq(unsafe { __intrinsic_log10_f64(100.0) }, 2.0, eps), "log10")

    assert(approxEq(unsafe { __intrinsic_floor_f64(3.7) }, 3.0, eps), "floor")
    assert(approxEq(unsafe { __intrinsic_ceil_f64(3.2) }, 4.0, eps), "ceil")
    assert(approxEq(unsafe { __intrinsic_trunc_f64(-3.7) }, -3.0, eps), "trunc")
    assert(approxEq(unsafe { __intrinsic_round_f64(2.3) }, 2.0, eps), "round")
    assert(approxEq(unsafe { __intrinsic_roundeven_f64(2.5) }, 2.0, eps), "roundeven")

    assert(approxEq(unsafe { __intrinsic_pow_f64(2.0, 3.0) }, 8.0, eps), "pow")
    let exp: int32 = 3
    assert(approxEq(unsafe { __intrinsic_powi_f64_i32(2.0, exp) }, 8.0, eps), "powi")
    assert(approxEq(unsafe { __intrinsic_copysign_f64(3.0, -1.0) }, -3.0, eps), "copysign")
    assert(approxEq(unsafe { __intrinsic_fma_f64(2.0, 3.0, 4.0) }, 10.0, eps), "fma")

    assert(approxEq(unsafe { __intrinsic_minimum_f64(2.0, 3.0) }, 2.0, eps), "minimum")
    assert(approxEq(unsafe { __intrinsic_maximum_f64(2.0, 3.0) }, 3.0, eps), "maximum")
    assert(approxEq(unsafe { __intrinsic_minimumnum_f64(2.0, 3.0) }, 2.0, eps), "minimumnum")
    assert(approxEq(unsafe { __intrinsic_maximumnum_f64(2.0, 3.0) }, 3.0, eps), "maximumnum")

    print("std_intrinsic_math: PASS\n")
}
